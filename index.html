<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARinvitation - Buku Tamu Digital</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Vue JS -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- jsPDF & AutoTable -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <!-- QR Code Generator -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Playfair+Display:ital,wght@0,700;1,700&display=swap');
        
        body { font-family: 'Inter', sans-serif; }
        .font-serif { font-family: 'Playfair Display', serif; }
        
        [v-cloak] { display: none; }
        
        .transition-theme { transition: all 0.5s ease; }

        .slide-up-enter-active, .slide-up-leave-active {
            transition: all 0.3s ease-out;
        }
        .slide-up-enter-from { transform: translateY(20px); opacity: 0; }
        .slide-up-leave-to { transform: translateY(-20px); opacity: 0; }

        @media print {
            header, nav, .no-print { display: none !important; }
            .print-only { display: block !important; }
            body { background: white !important; color: black !important; }
        }

        .animate-fadeIn {
            animation: fadeIn 0.5s ease-in-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        #qrcode img {
            margin: 0 auto;
            border: 8px solid white;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="transition-theme">
    <div id="app" v-cloak :class="[theme.secondary, theme.text, 'min-h-screen relative']">
        
        <!-- NOTIFIKASI -->
        <transition name="slide-up">
            <div v-if="showNotification" class="fixed bottom-10 left-1/2 -translate-x-1/2 z-[100] bg-green-600 text-white px-6 py-3 rounded-full shadow-2xl flex items-center gap-3">
                <i data-lucide="check-circle" class="w-5 h-5"></i>
                <span class="font-bold">{{ notificationMessage }}</span>
            </div>
        </transition>

        <!-- MODAL QR CODE SELF CHECK-IN -->
        <div v-if="showQRModal" class="fixed inset-0 bg-black bg-opacity-80 z-[200] flex items-center justify-center p-4">
            <div class="bg-white rounded-3xl p-8 max-w-sm w-full text-center relative animate-fadeIn">
                <button @click="showQRModal = false" class="absolute top-4 right-4 text-slate-400"><i data-lucide="x"></i></button>
                <h3 class="text-xl font-bold text-slate-900 mb-2 font-serif">Self Check-in QR</h3>
                <p class="text-xs text-slate-500 mb-6 italic">Scan kode ini agar tamu bisa mengisi data langsung dari HP mereka dan masuk ke database.</p>
                <div id="qrcode" class="mb-6 flex justify-center"></div>
                <div class="space-y-2">
                    <button @click="copyURL" class="text-[10px] text-slate-400 hover:text-slate-600 break-all font-mono underline">Salin Link Registrasi Mandiri</button>
                </div>
                <button @click="showQRModal = false" :class="[theme.primary, 'mt-6 w-full py-3 text-white rounded-xl font-bold']">Tutup</button>
            </div>
        </div>

        <!-- HEADER (Hanya Admin) -->
        <header v-if="!isSelfCheckIn" :class="[theme.primary, 'text-white shadow-lg sticky top-0 z-50 transition-theme no-print']">
            <div class="max-w-6xl mx-auto px-4 h-16 flex items-center justify-between">
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-white rounded-full flex items-center justify-center text-slate-900 font-bold">AR</div>
                    <span class="text-xl font-bold tracking-tight">{{ weddingInfo.logoText }}</span>
                </div>

                <nav class="hidden md:flex space-x-6">
                    <button @click="activeTab = 'beranda'" class="flex items-center space-x-1 hover:opacity-80" :class="{'border-b-2 border-white': activeTab === 'beranda'}">
                        <i data-lucide="home" class="w-4 h-4"></i> <span>Beranda</span>
                    </button>
                    <button @click="activeTab = 'registrasi'" class="flex items-center space-x-1 hover:opacity-80" :class="{'border-b-2 border-white': activeTab === 'registrasi'}">
                        <i data-lucide="user-plus" class="w-4 h-4"></i> <span>Registrasi</span>
                    </button>
                    <button @click="activeTab = 'database'" class="flex items-center space-x-1 hover:opacity-80" :class="{'border-b-2 border-white': activeTab === 'database'}">
                        <i data-lucide="database" class="w-4 h-4"></i> <span>Laporan</span>
                    </button>
                    <button @click="activeTab = 'pengaturan'" class="flex items-center space-x-1 hover:opacity-80" :class="{'border-b-2 border-white': activeTab === 'pengaturan'}">
                        <i data-lucide="settings" class="w-4 h-4"></i> <span>Pengaturan</span>
                    </button>
                </nav>
            </div>
        </header>

        <main class="max-w-6xl mx-auto p-4 md:p-8">
            
            <!-- MODE CHECK-IN MANDIRI (TAMPILAN TAMU) -->
            <section v-if="isSelfCheckIn" class="animate-fadeIn py-10">
                <div class="max-w-xl mx-auto">
                    <div class="text-center mb-10">
                        <h2 :class="[theme.accent, 'text-xs uppercase tracking-[0.3em] mb-4 font-semibold']">Digital Guestbook</h2>
                        <h1 class="text-4xl font-serif mb-2">{{ weddingInfo.mempelai }}</h1>
                        <p class="text-slate-500 italic">Selamat datang! Silakan isi data kehadiran Anda.</p>
                    </div>
                    
                    <div :class="[theme.card, 'p-8 rounded-3xl shadow-2xl border transition-theme']">
                        <div class="flex items-center gap-3 mb-8 pb-4 border-b">
                            <i data-lucide="user-check" :class="theme.accent" class="w-6 h-6"></i>
                            <h2 class="text-xl font-bold">Check-in Kehadiran</h2>
                        </div>
                        <form @submit.prevent="submitGuest" class="space-y-5">
                            <div>
                                <label class="block text-sm font-semibold mb-2">Nama Lengkap</label>
                                <input v-model="form.nama" required class="w-full p-4 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-slate-400 bg-slate-50" placeholder="Nama Anda..." />
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-semibold mb-2">WhatsApp</label>
                                    <input v-model="form.hp" required type="tel" class="w-full p-4 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-slate-400 bg-slate-50" placeholder="08xx..." />
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">Kategori</label>
                                    <select v-model="form.kategori" class="w-full p-4 rounded-xl border border-slate-200 outline-none bg-slate-50">
                                        <option v-for="cat in categories" :key="cat" :value="cat">{{ cat }}</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">Alamat / Instansi</label>
                                <input v-model="form.alamat" class="w-full p-4 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-slate-400 bg-slate-50" placeholder="Kota/Instansi..." />
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">Ucapan & Doa</label>
                                <textarea v-model="form.ucapan" rows="3" class="w-full p-4 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-slate-400 bg-slate-50" placeholder="Tulis doa Anda..."></textarea>
                            </div>
                            <button type="submit" :class="[theme.button, 'w-full py-5 text-white font-bold rounded-2xl shadow-xl transition-all active:scale-95 flex items-center justify-center gap-2']">
                                <i data-lucide="send" class="w-5 h-5"></i> Konfirmasi Kehadiran
                            </button>
                        </form>
                    </div>
                </div>
            </section>

            <!-- BERANDA (Admin) -->
            <section v-if="!isSelfCheckIn && activeTab === 'beranda'" class="space-y-8 animate-fadeIn no-print">
                <div :class="[theme.card, 'p-10 rounded-3xl text-center shadow-xl border relative overflow-hidden transition-theme']">
                    <h2 :class="[theme.accent, 'text-sm uppercase tracking-[0.3em] mb-4 font-semibold']">Wedding Reception</h2>
                    <h1 class="text-5xl md:text-7xl font-serif mb-6">{{ weddingInfo.mempelai }}</h1>
                    <div class="flex flex-col md:flex-row items-center justify-center gap-4 text-lg">
                        <span class="flex items-center gap-2"><i data-lucide="calendar" class="w-5 h-5"></i> {{ weddingInfo.tanggal }}</span>
                        <span class="hidden md:block">|</span>
                        <span class="flex items-center gap-2"><i data-lucide="map-pin" class="w-5 h-5"></i> {{ weddingInfo.lokasi }}</span>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div :class="[theme.card, 'p-6 rounded-2xl shadow-md border transition-theme']">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="font-bold text-lg flex items-center gap-2"><i data-lucide="users" :class="theme.accent"></i> Total Hadir</h3>
                            <span class="text-2xl font-black">{{ guests.length }}</span>
                        </div>
                        <div class="w-full bg-slate-100 rounded-full h-4 overflow-hidden">
                            <div :class="[theme.primary, 'h-full transition-all duration-1000']" :style="{ width: Math.min((guests.length / maxGuests * 100), 100) + '%' }"></div>
                        </div>
                        <p class="mt-2 text-sm text-slate-500 text-right">Target: {{ maxGuests }} Tamu</p>
                    </div>

                    <div :class="[theme.card, 'md:col-span-2 p-6 rounded-2xl shadow-md border transition-theme']">
                        <h3 class="font-bold text-lg mb-4 flex items-center gap-2"><i data-lucide="bar-chart-3" :class="theme.accent"></i> Statistik Kategori</h3>
                        <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                            <div v-for="cat in statsPerCategory" :key="cat.name" class="bg-black bg-opacity-5 p-3 rounded-xl border border-black border-opacity-5">
                                <p class="text-[10px] text-slate-500 font-bold uppercase">{{ cat.name }}</p>
                                <p class="text-xl font-bold">{{ cat.count }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- REGISTRASI (Admin) -->
            <section v-if="!isSelfCheckIn && activeTab === 'registrasi'" class="space-y-6 animate-fadeIn">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2 space-y-6">
                        <div :class="[theme.card, 'p-8 rounded-2xl shadow-xl border transition-theme no-print']">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-xl font-bold flex items-center gap-2">
                                    <i data-lucide="edit-3" :class="theme.accent"></i> Registrasi Tamu (Manual)
                                </h2>
                                <button @click="generateQR" class="flex items-center gap-2 bg-slate-100 px-4 py-2 rounded-lg text-xs font-bold hover:bg-slate-200 transition-all">
                                    <i data-lucide="qr-code" class="w-4 h-4"></i> QR Self Check-in
                                </button>
                            </div>
                            <form @submit.prevent="submitGuest" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold mb-1">Nama Tamu</label>
                                    <input v-model="form.nama" required class="w-full p-3 rounded-lg border border-slate-200 outline-none focus:ring-2 focus:ring-slate-400" placeholder="Ketik nama lengkap..." />
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-semibold mb-1">WhatsApp</label>
                                        <input v-model="form.hp" required type="tel" class="w-full p-3 rounded-lg border border-slate-200 outline-none focus:ring-2 focus:ring-slate-400" placeholder="08xx..." />
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold mb-1">Kategori</label>
                                        <select v-model="form.kategori" class="w-full p-3 rounded-lg border border-slate-200 outline-none bg-white">
                                            <option v-for="cat in categories" :key="cat" :value="cat">{{ cat }}</option>
                                        </select>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-1">Alamat / Instansi</label>
                                    <input v-model="form.alamat" class="w-full p-3 rounded-lg border border-slate-200 outline-none focus:ring-2 focus:ring-slate-400" placeholder="Kota atau asal instansi..." />
                                </div>
                                <button type="submit" :class="[theme.button, 'w-full py-4 text-white font-bold rounded-xl shadow-lg transition-all active:scale-95']">
                                    Simpan & Check-in
                                </button>
                            </form>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <div :class="[theme.card, 'p-6 rounded-2xl shadow-lg border no-print']">
                            <h3 class="text-sm font-bold mb-4 flex items-center gap-2 uppercase tracking-wider text-slate-400">
                                <i data-lucide="history" class="w-4 h-4"></i> Kedatangan Terakhir
                            </h3>
                            <div class="space-y-3">
                                <div v-for="g in guests.slice(0, 5)" :key="g.id" class="flex items-center justify-between p-3 bg-slate-50 rounded-xl border border-slate-100">
                                    <div class="overflow-hidden">
                                        <p class="font-bold text-sm truncate">{{ g.nama }}</p>
                                        <p class="text-[10px] text-slate-400">{{ g.time }} â€¢ {{ g.kategori }}</p>
                                    </div>
                                    <button @click="deleteGuest(g.id)" class="text-red-300 hover:text-red-500"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                                </div>
                                <div v-if="guests.length === 0" class="text-center py-6 text-slate-400 italic text-xs">Belum ada data</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- LAPORAN (Admin) -->
            <section v-if="!isSelfCheckIn && activeTab === 'database'" class="space-y-6 animate-fadeIn no-print">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                    <h2 class="text-2xl font-bold">Database Tamu</h2>
                    <div class="flex flex-wrap gap-2">
                        <button @click="exportToPDF" class="bg-red-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-red-700 text-sm font-bold shadow-md transition-all active:scale-95">
                            <i data-lucide="file-down" class="w-4 h-4"></i> Cetak PDF
                        </button>
                    </div>
                </div>

                <div class="overflow-x-auto rounded-2xl border border-slate-200 bg-white shadow-sm">
                    <table class="w-full text-left">
                        <thead class="bg-slate-50 border-b text-[10px] uppercase text-slate-400 font-bold">
                            <tr>
                                <th class="p-4 w-12">No</th>
                                <th class="p-4">Waktu</th>
                                <th class="p-4">Nama Tamu</th>
                                <th class="p-4">Kategori</th>
                                <th class="p-4">WhatsApp</th>
                                <th class="p-4 text-center">Aksi</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-100">
                            <tr v-for="(g, index) in guests" :key="g.id" class="hover:bg-slate-50">
                                <td class="p-4 text-xs font-bold text-slate-300">{{ index + 1 }}</td>
                                <td class="p-4 text-xs text-slate-400 whitespace-nowrap">{{ g.time }}</td>
                                <td class="p-4 font-bold">{{ g.nama }}</td>
                                <td class="p-4"><span :class="[theme.primary, 'px-2 py-0.5 rounded text-[10px] text-white font-bold uppercase']">{{ g.kategori }}</span></td>
                                <td class="p-4 text-sm font-mono text-slate-600">{{ g.hp }}</td>
                                <td class="p-4 text-center">
                                    <button @click="deleteGuest(g.id)" class="text-red-300 hover:text-red-600"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- PENGATURAN (Admin) -->
            <section v-if="!isSelfCheckIn && activeTab === 'pengaturan'" class="animate-fadeIn no-print max-w-2xl mx-auto space-y-6">
                <!-- Tema -->
                <div :class="[theme.card, 'p-8 rounded-2xl shadow-xl border transition-theme space-y-4']">
                    <h3 class="text-xl font-bold flex items-center gap-2"><i data-lucide="palette" :class="theme.accent"></i> Tema Aplikasi</h3>
                    <div class="grid grid-cols-1 gap-3">
                        <button v-for="(t, key) in themeOptions" :key="key" @click="currentTheme = key" 
                            :class="[currentTheme === key ? 'border-slate-800 bg-slate-50 shadow-inner' : 'border-transparent bg-white', 'p-4 rounded-xl border-2 flex items-center gap-4 transition-all']">
                            <div :class="[t.primary, 'w-6 h-6 rounded-full shadow-inner']"></div>
                            <span class="font-bold text-sm">{{ t.name }}</span>
                        </button>
                    </div>
                </div>

                <!-- Manajemen Kategori -->
                <div :class="[theme.card, 'p-8 rounded-2xl shadow-xl border transition-theme space-y-4']">
                    <h3 class="text-xl font-bold flex items-center gap-2"><i data-lucide="tags" :class="theme.accent"></i> Edit Kategori Tamu</h3>
                    <div class="flex gap-2">
                        <input v-model="newCategory" @keyup.enter="addCategory" class="flex-1 p-3 rounded-lg border border-slate-200 outline-none focus:ring-2 focus:ring-slate-400" placeholder="Tambah kategori..." />
                        <button @click="addCategory" :class="[theme.primary, 'text-white px-4 rounded-lg font-bold shadow-md']"><i data-lucide="plus"></i></button>
                    </div>
                    <div class="flex flex-wrap gap-2 mt-4">
                        <div v-for="(cat, index) in categories" :key="index" class="bg-slate-100 px-3 py-1.5 rounded-full flex items-center gap-2 border border-slate-200">
                            <span class="text-sm font-semibold">{{ cat }}</span>
                            <button @click="removeCategory(index)" class="text-slate-400 hover:text-red-500"><i data-lucide="x" class="w-3 h-3"></i></button>
                        </div>
                    </div>
                </div>

                <!-- Tombol Berbahaya -->
                <div class="p-8 rounded-2xl border-2 border-red-100 bg-red-50 space-y-4">
                    <h3 class="text-red-600 font-bold flex items-center gap-2"><i data-lucide="alert-triangle"></i> Area Berbahaya</h3>
                    <button @click="resetAllData" class="w-full bg-white border-2 border-red-500 text-red-500 py-3 rounded-xl font-bold hover:bg-red-500 hover:text-white transition-all">
                        Reset Seluruh Database Tamu
                    </button>
                </div>
            </section>

        </main>
    </div>

  <script>
    const { createApp, ref, computed, onMounted, nextTick, watch } = Vue;

    createApp({
        setup() {
            // URL Google Apps Script Anda
            const DATABASE_URL = 'https://script.google.com/macros/s/AKfycbwZs8Pkk1dPnIeTuIwcPLa01_d7zUhknHiQCgUrYggXTsaFQRuTvw2X9bXuGCidJ9J0Jg/exec';

            const activeTab = ref('beranda');
            const guests = ref([]);
            const maxGuests = ref(500);
            const currentTheme = ref('modern');
            const categories = ref(['Keluarga', 'Teman', 'VVIP', 'Rekan Kerja']);
            const newCategory = ref('');

            const showNotification = ref(false);
            const notificationMessage = ref('Data Berhasil Disimpan!');
            const isSelfCheckIn = ref(false);
            const showQRModal = ref(false);
            
            const form = ref({ nama: '', hp: '', alamat: '', kategori: 'Keluarga', ucapan: '' });

            const weddingInfo = {
                mempelai: "Andi & Rina",
                tanggal: "12 Desember 2025",
                lokasi: "Hotel Mulia, Senayan",
                logoText: "AR Wedding"
            };

            const themeOptions = {
                modern: { name: 'Dark Onyx', primary: 'bg-slate-900', secondary: 'bg-white', accent: 'text-slate-900', button: 'bg-slate-800 hover:bg-slate-700', card: 'bg-white', text: 'text-slate-800' },
                romantic: { name: 'Blush Pink', primary: 'bg-rose-500', secondary: 'bg-rose-50', accent: 'text-rose-600', button: 'bg-rose-600 hover:bg-rose-500', card: 'bg-white', text: 'text-rose-900' },
                luxury: { name: 'Royal Amber', primary: 'bg-amber-800', secondary: 'bg-stone-50', accent: 'text-amber-800', button: 'bg-amber-800 hover:bg-amber-700', card: 'bg-white', text: 'text-stone-900' }
            };

            const selfCheckInURL = computed(() => {
                const url = new URL(window.location.href);
                url.searchParams.set('mode', 'checkin');
                return url.toString();
            });

            const theme = computed(() => themeOptions[currentTheme.value]);

            const statsPerCategory = computed(() => {
                return categories.value.map(c => ({ name: c, count: guests.value.filter(g => g.kategori === c).length }));
            });

            const addCategory = () => {
                const val = newCategory.value.trim();
                if (val && !categories.value.includes(val)) {
                    categories.value.push(val);
                    newCategory.value = '';
                    saveSettings();
                }
            };

            const removeCategory = (index) => {
                if(categories.value.length > 1) {
                    categories.value.splice(index, 1);
                    saveSettings();
                }
            };

            const saveSettings = () => {
                localStorage.setItem('ar_wedding_categories', JSON.stringify(categories.value));
            };

            const loadSettings = () => {
                const saved = localStorage.getItem('ar_wedding_categories');
                if (saved) categories.value = JSON.parse(saved);
                form.value.kategori = categories.value[0];
            };

            const loadGuests = async () => {
                try {
                    const response = await fetch(DATABASE_URL);
                    const data = await response.json();
                    guests.value = data.reverse().map(g => ({
                        ...g,
                        id: g.id || Math.random()
                    }));
                } catch (e) {
                    console.error("Gagal sinkronisasi database.");
                }
            };

            const submitGuest = async () => {
                const newGuest = {
                    nama: form.value.nama,
                    hp: form.value.hp,
                    alamat: form.value.alamat,
                    kategori: form.value.kategori,
                    ucapan: form.value.ucapan,
                    time: new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' })
                };

                // Optimistic UI update
                guests.value.unshift({ id: Date.now(), ...newGuest });
                
                notificationMessage.value = isSelfCheckIn.value ? 'Terima kasih, kehadiran Anda tercatat!' : 'Data Berhasil Disimpan!';
                showNotification.value = true;
                setTimeout(() => { showNotification.value = false; }, 4000);

                try {
                    await fetch(DATABASE_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        body: JSON.stringify({ action: 'insert', ...newGuest })
                    });
                    
                    form.value = { ...form.value, nama: '', hp: '', alamat: '', ucapan: '' };
                    nextTick(() => lucide.createIcons());
                } catch (e) {
                    console.error("Gagal mengirim ke Google Sheets");
                }
            };

            const deleteGuest = async (id) => { 
                if(confirm("Hapus data tamu ini?")) {
                    const guestToDelete = guests.value.find(g => g.id === id);
                    guests.value = guests.value.filter(g => g.id !== id);
                    
                    await fetch(DATABASE_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        body: JSON.stringify({ action: 'delete', nama: guestToDelete.nama })
                    });
                }
            };

            const resetAllData = async () => {
                const confirmInput = prompt("Ketik 'HAPUS' untuk mengosongkan database:");
                if(confirmInput === 'HAPUS') {
                    await fetch(DATABASE_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        body: JSON.stringify({ action: 'reset' })
                    });
                    guests.value = [];
                    notificationMessage.value = 'Database Dikosongkan!';
                    showNotification.value = true;
                    setTimeout(() => { showNotification.value = false; }, 3000);
                }
            };

            const generateQR = () => {
                showQRModal.value = true;
                nextTick(() => {
                    const container = document.getElementById("qrcode");
                    container.innerHTML = "";
                    new QRCode(container, {
                        text: selfCheckInURL.value,
                        width: 256,
                        height: 256,
                        colorDark: "#000000",
                        colorLight: "#ffffff",
                        correctLevel: QRCode.CorrectLevel.H
                    });
                });
            };

            const copyURL = () => {
                navigator.clipboard.writeText(selfCheckInURL.value);
                notificationMessage.value = "Link berhasil disalin!";
                showNotification.value = true;
                setTimeout(() => showNotification.value = false, 2000);
            };

            const exportToPDF = () => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                doc.text(`LAPORAN TAMU: ${weddingInfo.mempelai}`, 14, 15);
                doc.autoTable({
                    startY: 25,
                    head: [['No', 'Waktu', 'Nama', 'Kategori', 'WhatsApp']],
                    body: guests.value.map((g, i) => [i + 1, g.time, g.nama, g.kategori, g.hp]),
                });
                doc.save(`Daftar_Hadir.pdf`);
            };

            onMounted(() => {
                loadSettings();
                const params = new URLSearchParams(window.location.search);
                if (params.get('mode') === 'checkin') isSelfCheckIn.value = true;
                loadGuests();
                lucide.createIcons();
            });

            watch(activeTab, () => {
                nextTick(() => lucide.createIcons());
            });

            return {
                activeTab, guests, maxGuests, currentTheme,
                categories, newCategory, showNotification, notificationMessage, isSelfCheckIn, form, weddingInfo,
                themeOptions, theme, statsPerCategory, 
                submitGuest, deleteGuest, resetAllData, exportToPDF,
                showQRModal, selfCheckInURL, generateQR, copyURL,
                addCategory, removeCategory
            };
        }
    }).mount('#app');
  </script>
</body>
</html>